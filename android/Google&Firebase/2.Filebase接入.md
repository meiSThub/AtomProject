

# 一、Firebase Performance

Firebase 崩溃日志收集Sdk集成。[官方文档](https://firebase.google.com/docs/crashlytics/get-started?hl=zh&authuser=0&platform=android)

## **第 1 步**：将性能监控 SDK 添加到您的应用

添加性能监控 SDK 后，Firebase 会自动开始收集应用[屏幕渲染](https://firebase.google.com/docs/perf-mon/screen-traces)的数据以及与应用生命周期相关的数据（例如[应用启动时间](https://firebase.google.com/docs/perf-mon/app-start-foreground-background-traces)）。要使 Firebase 能够监控网络请求，您*还*必须添加性能监控 Gradle 插件（下一步）。

1、在您的**模块（应用级）Gradle 文件**（通常是`<project>/<app-module>/build.gradle` ）中，添加 Performance Monitoring Android 库的依赖项。我们建议使用[Firebase Android BoM](https://firebase.google.com/docs/android/learn-more#bom)来控制库版本控制。

```groovy
dependencies {
    // Import the BoM for the Firebase platform
    implementation platform('com.google.firebase:firebase-bom:31.1.0')

    // Add the dependency for the Performance Monitoring library
    // When using the BoM, you don't specify versions in Firebase library dependencies
    implementation 'com.google.firebase:firebase-perf'
}
```

2、重新编译您的应用程序。

## **第 2 步**：将性能监控 Gradle 插件添加到您的应用程序

添加性能监控 Gradle 插件后，Firebase 会自动开始收集[HTTP/S 网络请求](https://firebase.google.com/docs/perf-mon/network-traces?platform=android)的数据。该插件还使您能够使用[@AddTrace 注释](https://firebase.google.com/docs/perf-mon/custom-code-traces?platform=android#add-trace-annotation)来检测自定义代码跟踪。

1、在您的**根级（项目级）** Gradle 文件 ( `<project>/build.gradle` ) 中，将 Performance Monitoring Gradle 插件添加为 buildscript 依赖项：

```groovy
buildscript {
    repositories {
      // Make sure that you have the following two repositories
      google()  // Google's Maven repository
      mavenCentral()  // Maven Central repository
    }

    dependencies {
        ...
        // To benefit from the latest Performance Monitoring plugin features,
        // update your Android Gradle plugin dependency to at least v3.4.0
        classpath 'com.android.tools.build:gradle:7.2.0'

        // Make sure that you have the Google services Gradle plugin dependency
        classpath 'com.google.gms:google-services:4.3.14'

        // Add the dependency for the Performance Monitoring Gradle plugin
        classpath 'com.google.firebase:perf-plugin:1.4.2'
    }
}
```

2、在您的**模块（应用级）** Gradle 文件（通常是`<project>/<app-module>/build.gradle` ）中，添加性能监控 Gradle 插件：

```groovy
plugins {
    id 'com.android.application'

    // Make sure that you have the Google services Gradle plugin
    id 'com.google.gms.google-services'

    // Add the Performance Monitoring Gradle plugin
    id 'com.google.firebase.firebase-perf'
    ...
}
```

3、重新编译您的应用程序。

## **第 3 步**：为初始数据显示生成性能事件

当您成功将 SDK 添加到您的应用时，Firebase 开始处理这些事件。如果您仍在本地开发，请与您的应用交互以生成用于初始数据收集和处理的事件。

1. 通过在后台和前台之间多次切换您的应用程序、通过跨屏幕导航与您的应用程序交互和/或触发网络请求来生成事件。

2. 转到 Firebase 控制台的[*性能*信息中心](https://console.firebase.google.com/project/_/performance)。您应该会在几分钟内看到您的初始数据显示。

   如果您没有看到初始数据的显示，请查看[故障排除提示](https://firebase.google.com/docs/perf-mon/troubleshooting?platform=android#sdk-detected-no-data)。

## **第 4 步**：（*可选）*查看性能事件的日志消息

通过将`<meta-data>`元素添加到应用的`AndroidManifest.xml`文件中，在构建时启用性能监控的调试日志记录，如下所示：

```groovy
<application>
    <meta-data
      android:name="firebase_performance_logcat_enabled"
      android:value="true" />
</application>
```

1. 检查您的日志消息中是否有任何错误消息。

2. 性能监控使用`FirebasePerformance`标记其日志消息。使用 logcat 过滤，您可以通过运行以下命令来专门查看持续时间跟踪和 HTTP/S 网络请求日志记录：

   ```shell
   adb logcat -s FirebasePerformance
   ```

3. 检查以下类型的日志，这些日志表明性能监控正在记录性能事件：

   - `Logging trace metric: TRACE_NAME , FIREBASE_PERFORMANCE_CONSOLE_URL`
   - `Logging network request trace: URL`

4. 单击 URL 以在 Firebase 控制台中查看您的数据。数据在仪表板中更新可能需要一些时间。

如果您的应用没有记录性能事件，请查看[故障排除提示](https://firebase.google.com/docs/perf-mon/troubleshooting?platform=android#app-not-logging-events)。



[故障排除和常见问题解答](https://firebase.google.cn/docs/perf-mon/troubleshooting?platform=android#check-logs-for-events)：

* 如果在 Firebase 上没有看到性能数据，则检测App网络是否可以访问外网。
* 可以打开 Firebase Logcat 日志，查看日志是否有打印，Firebase 的 日志 tag 为：**FirebasePerformance**，如：

![image-20221130151423399](https://raw.githubusercontent.com/meiSThub/BlogImage/master/2022/image-20221130151423399.png)

# 二、Firebase Crashlytics

## 在你开始之前

1. 如果您还没有，[请将 Firebase 添加](https://firebase.google.com/docs/android/setup)到您的 Android 项目中。如果您没有 Android 应用，可以下载[示例应用](https://firebase.google.com/docs/samples)。

2. **推荐**：要获得无崩溃用户、面包屑日志和速度警报等功能，您需要在 Firebase 项目中启用 Google Analytics。

   

   - 如果您现有的 Firebase 项目未启用 Google Analytics，您可以从 Firebase 控制台中settings >*项目设置*的[**集成**选项卡](https://console.firebase.google.com/project/_/settings/integrations/analytics)启用 Google Analytics。
   - 如果您要创建新的 Firebase 项目，请在项目创建工作流程中启用 Google Analytics。

## **第 1 步**：将 Crashlytics SDK 添加到您的应用程序

在您的**模块（应用级）Gradle 文件**（通常是`<project>/<app-module>/build.gradle` ）中，添加 Crashlytics Android 库的依赖项。我们建议使用[Firebase Android BoM](https://firebase.google.com/docs/android/learn-more#bom)来控制库版本控制。

为了获得 Crashlytics 的最佳体验，我们建议在您的 Firebase 项目中[启用 Google Analytics](https://support.google.com/firebase/answer/9289399#linkga) ，并将适用于 Google Analytics 的 Firebase SDK 添加到您的应用中。

```groovy
dependencies {
    // Import the BoM for the Firebase platform
    implementation platform('com.google.firebase:firebase-bom:31.1.0')

    // Add the dependencies for the Crashlytics and Analytics libraries
    // When using the BoM, you don't specify versions in Firebase library dependencies
    implementation 'com.google.firebase:firebase-crashlytics'
    implementation 'com.google.firebase:firebase-analytics'
}
```

通过使用[Firebase Android BoM](https://firebase.google.com/docs/android/learn-more#bom) ，您的应用将始终使用兼容版本的 Firebase Android 库。这样就不用指定 firebase-crashlytics 的版本号了。

## **第 2 步**：将 Crashlytics Gradle 插件添加到您的应用程序

1、在您的**根级（项目级）** Gradle 文件 ( `<project>/build.gradle` ) 中，添加 Crashlytics Gradle 插件作为 buildscript 依赖项：

```groovy
buildscript {
    repositories {
      // Make sure that you have the following two repositories
      google()  // Google's Maven repository
      mavenCentral()  // Maven Central repository
    }

    dependencies {
        ...
        classpath 'com.android.tools.build:gradle:7.2.0'

        // Make sure that you have the Google services Gradle plugin dependency
        classpath 'com.google.gms:google-services:4.3.14'

        // Add the dependency for the Crashlytics Gradle plugin
        classpath 'com.google.firebase:firebase-crashlytics-gradle:2.9.2'
    }
}
```

3、在您的**模块（应用级）** Gradle 文件（通常是`<project>/<app-module>/build.gradle` ）中，添加 Crashlytics Gradle 插件：

```groovy
plugins {
    id 'com.android.application'

    // Make sure that you have the Google services Gradle plugin
    id 'com.google.gms.google-services'

    // Add the Crashlytics Gradle plugin
    id 'com.google.firebase.crashlytics'
    ...
}
```

## **第 3 步**：强制测试崩溃以完成设置

要完成 Crashlytics 的设置并在 Firebase 控制台的 Crashlytics 控制面板中查看初始数据，您需要强制测试崩溃。

随便制作一个bug，查看Firebase上是否有崩溃日志上报。



就是这样！ Crashlytics 现在正在监控您的应用程序是否存在崩溃、非致命错误和 ANR。访问[Crashlytics 仪表板](https://console.firebase.google.com/project/_/crashlytics)以查看和调查您的所有报告和统计信息。