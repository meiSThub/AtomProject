

在 HTTP 协议中有可能存在信息窃听或身份伪装等安全问题。使用 HTTPS 通信机制可以有效地防止这些问题。本章我们就了解一下 HTTPS。

# 一、Http 的缺点

HTTP 具有相当优秀和方便的一面，然而 HTTP 并非只有好的一面，事物皆具两面性，它也是有不足之处的。 HTTP 主要有这些不足，例举如下。 

* 通信使用明文（不加密），内容可能会被窃听 

* 不验证通信方的身份，因此有可能遭遇伪装 

* 无法证明报文的完整性，所以有可能已遭篡改 

这些问题不仅在 HTTP 上出现，其他未加密的协议中也会存在这类问 题。除此之外，HTTP 本身还有很多缺点。



# 二、HTTPS = HTTP + 加密 + 认证 + 完整性保护

HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL（Secure Socket Layer）和 TLS（Transport Layer Security）协议代 替而已。 

通常，HTTP 直接和 TCP 通信。当使用 SSL时，则演变成先和 SSL通信，再由 SSL和 TCP 通信了。简言之，所谓 HTTPS，其实就是身披 SSL协议这层外壳的 HTTP。 

![image-20211108113107403](https://gitee.com/meiSThub/BlogImage/raw/master/2020/image-20211108113107403.png)

在采用 SSL后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护这些功能。

## 1、相互交换密钥的公开密钥加密技术 

SSL采用一种 叫做公开密钥加密（Public-key cryptography）的加密处理方式。 

近代的加密方法中加密算法是公开的，而密钥却是保密的。通过这种方式得以保持加密方法的安全性。 

加密和解密都会用到密钥。没有密钥就无法对密码解密，反过来说，任何人只要持有密钥就能解密了。如果密钥被攻击者获得，那加密也 就失去了意义。 

### 1-1、共享密钥加密的困境 

加密和解密同用一个密钥的方式称为共享密钥加密（Common key crypto system），也被叫做对称密钥加密。 

以共享密钥方式加密时必须将密钥也发给对方。可究竟怎样才能安全地转交？在互联网上转发密钥时，如果通信被监听那么密钥就可会落入攻击者之手，同时也就失去了加密的意义。另外还得设法安全地保管接收到的密钥。

![image-20211108113759455](https://gitee.com/meiSThub/BlogImage/raw/master/2020/image-20211108113759455.png)

### 1-2、使用两把密钥的公开密钥加密 

公开密钥加密使用一对非对称的密钥。一把叫做私有密钥 （private key），另一把叫做公开密钥（public key）。顾名思义，私有密钥不让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。 

使用公开密钥加密方式，发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥 进行解密。利用这种方式，不需要发送用来解密的私有密钥，也不必担心密钥被攻击者窃听而盗走。 

另外，要想根据**密文**和**公开密钥**，恢复到信息原文是异常困难的，因为解密过程就是在对离散对数进行求值，这并非轻而易举就能办到。退一步讲，如果能对一个非常大的整数做到快速地因 式分解，那么密码破解还是存在希望的。但就目前的技术来看是 不太现实的。 

![image-20211108114255847](https://gitee.com/meiSThub/BlogImage/raw/master/2020/image-20211108114255847.png)

### 1-3、**HTTPS** 采用混合加密机制 

HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密 机制。若密钥能够实现安全交换，那么有可能会考虑仅使用公开 密钥加密来通信。但是公开密钥加密与共享密钥加密相比，其处理速度要慢。 

所以应充分利用两者各自的优势，将多种方法组合起来用于通 信。在交换密钥环节使用公开密钥加密方式，之后的建立通信交 换报文阶段则使用共享密钥加密方式。

![image-20211108115010298](https://gitee.com/meiSThub/BlogImage/raw/master/2020/image-20211108115010298.png)

## 2、证明公开密钥正确性的证书 

公开密钥加密方式还是存在一些问题的。那就是无法证明 公开密钥本身就是货真价实的公开密钥。比如，正准备和某台服务器 建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。或许在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了。 

为了解决上述问题，可以使用由数字证书认证机构（CA，Certificate Authority）和其相关机构颁发的公开密钥证书。 

数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场上。

数字证书认证机构的业务流程：

* （1）首先，服务器的运营人员向数字证书认证机构提出公开密钥的申请，数字证书认证机构对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书 后绑定在一起。

* （2）服务器会将这份由数字证书认证机构颁发的 **公钥证书** 发送给客户端， 以进行公开密钥加密方式通信。

  **公钥证书**：也可叫做数字证书或直接称为证书。 

* （3）接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事： 

  * 认证服务器的公开密钥的是真实有效的数字证书认证机构。
  * 服务器的公开密钥是值得信赖的。

  

  此处认证机关的公开密钥必须安全地转交给客户端。使用通信方式时，如何安全转交是一件很困难的事，因此，多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥。 

  

### 2-1、可证明组织真实性的 **EV SSL** 证书 

证书的一个作用是用来证明作为通信一方的服务器是否规范，另外一个作用是可确认对方服务器背后运营的企业是否真实存在。拥有该特性的证书就是 EV SSL证书

### 2-2、用以确认客户端的客户端证书 

HTTPS 中还可以使用客户端证书。以客户端证书进行客户端认证，证明服务器正在通信的对方始终是预料之内的客户端，其作用跟服务器证书如出一辙。 

例如，银行的网上银行就采用了客户端证书。在登录网银时不仅要求用户确认输入 ID 和密码，还会要求用户的客户端证书，以确认用户是否从特定的终端访问网银。

客户端证书存在的另一个问题点是，客户端证书毕竟只能用来证明客户端实际存在，而不能用来证明用户本人的真实有效性。也就是说，只要获得了安装有客户端证书的计算机的使用权限，也就意味着同时拥有了客户端证书的使用权限。 

### 2-3、认证机构信誉第一

如果认证机构遭受攻击，导致伪造的证书流通，将导致通信变得不可靠。

### 2-4、由自认证机构颁发的证书称为自签名证书

如果使用 OpenSSL这套开源程序，每个人都可以构建一套属于自己的认证机构，从而自己给自己颁发服务器证书。但该服务器证书在互联网上不可作为证书使用，似乎没什么帮助。 

独立构建的认证机构叫做自认证机构，由自认证机构颁发的“无用”证书也被戏称为自签名证书。 

# 三、Https 握手过程

